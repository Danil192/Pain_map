# Спецификация варианта использования «Отправка данных врачу»

## Пользователи
**Пользователь** - авторизованный пользователь системы

## Цель
Передать врачу информацию о локализованной боли и её параметрах для последующего анализа и постановки диагноза.

## Краткое описание
Пользователь выбирает болевую точку, вводит параметры боли, затем отправляет данные врачу. Система собирает все параметры, идентификатор врача и упаковывает их в структуру JSON, после чего отправляет на сервер.

## Предусловия
1. Пользователь авторизован в системе
2. Данные боли уже введены (интенсивность, характер, триггеры и т.д.)
3. Выбран врач из списка доступных врачей
4. Сервер доступен для отправки (http://localhost:5000)

## Основной сценарий

### Шаг 1: Объединение данных
Система объединяет данные боли и ID врача в единый JSON-объект:

```json
{
  "doctor_id": 1,
  "doctor_name": "Иванов Иван Иванович",
  "doctor_specialty": "Терапевт",
  "pain_history": [
    {
      "id": 1234567890,
      "pain_point_name": "Локоть",
      "pain_intensity": 5,
      "pain_type": "Жгучая",
      "time_of_day": "Вечер",
      "body_position": "Нет",
      "breathing_relation": "Нет",
      "physical_activity_relation": "Да",
      "stress_relation": "Да",
      "record_date": "2025-11-25T10:21:29.000Z",
      "user_id": 1
    }
  ],
  "sent_at": "2025-11-25T10:30:00.000Z"
}
```

### Шаг 2: Отправка на сервер
Система отправляет JSON-структуру на сервер методом POST:
- **URL**: `http://localhost:5000/send-to-doctor`
- **Method**: POST
- **Headers**: `Content-Type: application/json`
- **Body**: JSON-объект с данными

### Шаг 3: Получение ответа
Сервер обрабатывает запрос и возвращает ответ:

**Успешный ответ (200 OK):**
```json
{
  "message": "Данные успешно отправлены врачу",
  "doctor_id": 1,
  "records_count": 1,
  "sent_at": "2025-11-25T10:30:00.000Z"
}
```

### Шаг 4: Уведомление пользователю
Отображается уведомление: **«Данные успешно отправлены врачу»**

### Шаг 5: Конец
Форма отправки закрывается, пользователь может продолжить работу.

---

## Альтернативный сценарий

### Шаг 10: Ошибка при отправке
Если сервер недоступен или произошла ошибка при отправке:

**Типы ошибок:**
- `Failed to fetch` / `NetworkError` - сервер недоступен
- `400 Bad Request` - неверный формат данных
- `500 Internal Server Error` - ошибка на сервере
- Другие ошибки сети

### Шаг 11: Сообщение об ошибке
Система выводит сообщение об ошибке:
- **Если сервер недоступен**: "Не удалось отправить данные. Сервер недоступен. Попробуйте позже."
- **В других случаях**: "Не удалось отправить данные. Попробуйте позже."

### Шаг 12: Возможность повтора
Пользователь может повторить попытку отправки позже:
- Форма отправки остается открытой
- Пользователь может выбрать другого врача
- Пользователь может отменить отправку

### Шаг 13: Переход к шагу 1
Пользователь может повторить попытку отправки.

---

## Список врачей в системе

1. **Терапевт** - Иванов Иван Иванович (ID: 1)
2. **Лор** - Кустов Кирилл Денисович (ID: 2)
3. **Дерматолог** - Сарапулов Игорь Александрович (ID: 3)

---

## Технические детали

### Фронтенд (React)
- **Компонент**: `PainHistoryModal.js`
- **Функция отправки**: `handleSendSingleRecord(record, doctorId)`
- **Источник данных врачей**: `src/data/doctors.js`
- **Хранение отправленных данных**: `localStorage` (ключ: `sentToDoctors`)

### Бэкенд (Express)
- **Эндпоинт**: `POST /send-to-doctor`
- **Порт**: 5000
- **Обработка**: Логирование данных в консоль (в продакшене - сохранение в БД)

### Структура данных

**Запись о боли содержит:**
- `id` - уникальный идентификатор записи
- `pain_point_name` - название точки боли (например, "Локоть")
- `pain_intensity` - интенсивность боли (1-10)
- `pain_type` - тип боли (Острая, Тупая, Пульсирующая, и т.д.)
- `time_of_day` - время суток (Утро, День, Вечер, Ночь, Всегда)
- `body_position` - связь с положением тела (Да/Нет)
- `breathing_relation` - связь с дыханием (Да/Нет)
- `physical_activity_relation` - связь с физической активностью (Да/Нет)
- `stress_relation` - связь со стрессом (Да/Нет)
- `record_date` - дата и время создания записи (ISO 8601)
- `user_id` - идентификатор пользователя

**Запрос к серверу содержит:**
- `doctor_id` - идентификатор выбранного врача
- `doctor_name` - полное имя врача
- `doctor_specialty` - специальность врача
- `pain_history` - массив записей о боли
- `sent_at` - время отправки (ISO 8601)

---

## Пример использования

1. Пользователь открывает "История болей"
2. Раскрывает запись о боли (например, "Боль #1 — Локоть — 25.11.2025, 10:21:29")
3. Нажимает кнопку "Отправить врачу"
4. Выбирает врача из списка (например, "Терапевт - Иванов Иван Иванович")
5. Нажимает "Подтвердить отправку"
6. Система отправляет данные на сервер
7. Получает подтверждение об успешной отправке
8. Видит уведомление "Данные успешно отправлены врачу"

